!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o,s=function(){$("#spinner-modal").modal(),$("#dicomImgModal").is(":visible")&&$("#dicomImgModal").modal("hide")},i=function(){$("#spinner-modal").modal("hide")},c={sendGetRequest:function(e,t){console.log("send get request"),s();const n=this.generateURL(e);return $.ajax({url:n,type:"GET",data:t,contentType:"application/json; charset=utf-8",dataType:"json"})},sendPostRequest:function(e,t){console.log("send post   request"),s();const n=this.generateURL(e);return $.ajax({url:n,type:"POST",data:JSON.stringify({payload:t}),contentType:"application/json; charset=utf-8",dataType:"json"})},generateURL:function(e){return location.protocol+"//"+location.host+e}},a=({init:function(){this.buttons.forEach(e=>{const t=this;$(e.id).click(function(){if(e.cliked)t.deactivateRest(e.id,e.container);else{t.activateButton(e.id,e.container);const n=t.buttons.find(t=>1==t.cliked&&t.id!=e.id);n&&t.deactivateRest(n.id,n.container)}})})},buttons:[{id:"#seed-button",container:"#seed-inputs-wrapper",cliked:!1},{id:"#kmeans-button",container:"#kmeans-inputs-wrapper",cliked:!1},{id:"#fuzzy-button",container:"#fuzzy-inputs-wrapper",cliked:!1}],activateButton:function(e,t){$(e).css({"background-color":"#21a522"}),$(t).css({display:"inherit"}),this.buttons.forEach(t=>{t.id==e&&(t.cliked=!0)})},deactivateRest:function(e,t){$(e).css({"background-color":"#20a5d6"}),$(t).css({display:"none"}),this.buttons.forEach(t=>{t.id==e&&(t.cliked=!1)})}}.init(),{activateClickEventListener:function(){var e=this;$(document).ready(function(){$('input[type="file"]').change(function(t){e.fileName=t.target.files[0].name,$('input[type="file"]')&&$("#buttons-wrapper").css("visibility","visible")})})},fileName:"",getLoadedFileName:function(){return this.fileName}}),r=({activateClickEventListeners:function(){var e=this;$(document).ready(function(){$(".carousel-submit-button").click(()=>{e.carouselSubmit()}),$(".carousel-inner").delegate("#canvas1","click",function(t){$(".reconstruction-no-points").remove(),e.reconstructionCoords.push({x:t.offsetX,y:t.offsetY}),$("#reconstruction-points-container").append(`<li>x: ${t.offsetX} y: ${t.offsetY}</li>`)}),$("#processing-button").click(()=>{if("rgb(33, 165, 34)"==$("#kmeans-button").css("background-color")){const t=$("input[type=number][name='kmeans']").val();const n={fileName:a.getLoadedFileName(),clustersNumber:t},o="/kmeans/step1";e.generateCarousel(n,t,o)}}),$("#processing-button").click(()=>{if("rgb(33, 165, 34)"==$("#fuzzy-button").css("background-color")){const t=$("input[type=number][name='fuzzy']").val();const n={fileName:a.getLoadedFileName(),clustersNumber:t},o="/fuzzy/step1";e.generateCarousel(n,t,o)}}),$(".filters-list li").click(function(){$(this).css({"background-color":"#d09c00"});for(let e=0;e<5;e++)$(this).index()!==e&&"rgb(68, 66, 66)"!==$(`.filters-list li:nth-child(${e+1})`).css("background-color")&&$(`.filters-list li:nth-child(${e+1})`).css({"background-color":"rgb(68, 66, 66)"});switch(e.clickedFilterIndex=$(this).index(),$(this).index()){case 0:e.modifyInput("make hidden"),$(".reconstruction-pts").removeClass("d-none"),$(".reconstruction-pts").addClass("d-flex"),$("#canvas1").css({cursor:"crosshair"});break;case 2:$(".carousel-input").val(null),e.modifyInput("reset",null).modifyInput("make visible").modifyInput("set placeholder","Choose structural element size in px");break;case 3:e.modifyInput("reset",null).modifyInput("make visible").modifyInput("set placeholder","Choose structural element size in px");break;default:e.modifyInput("make hidden")}})})},clickedFilterIndex:null,generateCarousel:function(e,t,n){var o=this;c.sendGetRequest(n,e).done(function(e){console.log(e),i(),$("#dicomImgModal").is(":visible")||$("#dicomImgModal").modal(),o.feelCarouselWithData(e,t)}).fail(function(e){console.log(e)})},feelCarouselWithData:function(e,t){var n=this;n.clusteredImages=e.arrayOfImgs,e.arrayOfImgs.forEach((e,t)=>{const o=cv.matFromArray(512,512,cv.CV_8U,[].concat.apply([],e));let s,i;0===t?(s=n.activeSlideDOM.replace("#INDEX#",t).replace("#INDEX+1#",t+1),i=n.activeItemIndicator.replace("#INDEX+1#",t+1)):(s=n.notActiveSlideDOM.replace("#INDEX#",t).replace("#INDEX+1#",t+1),i=n.notActiveItemIndicator.replace("#INDEX+1#",t+1)),$(".carousel-inner").append(s),$(".carousel-indicators").append(i),$(".carousel-item").css({width:"100%",height:"600px"}),cv.imshow(`canvas${t}`,o)}),n.activateCarousel(t),$("#dicomImgModal").modal()},resetCarousel:function(){$(".carousel-container").html(this.emptyCarouselHTML),$(".carousel-container").html(),this.modifyInput("reset",null).modifyInput("make visible").modifyInput("set placeholder",'"Image number (example: 2)"'),$(".carousel-input").attr("name","step1"),$(".processing-filters").css({display:"none"}),$("#reconstruction-points-container").append('<div class="reconstruction-no-points">no points choosen.</div>'),$(".carousel-modal-title").text("Step1: select one clustered image for further processing.")},carouselSubmit:function(){var e=this;if("step2"===$(".carousel-input").attr("name")){console.log("KMEANS STEP3"),this.appendColours();let t,n,o=e.clickedFilterIndex,s={filterNumber:o+1,imgNumber:e.choosenImageNumber-1},a=!1;switch(console.log(o),o){case 0:t=Object.assign(s,{reconstructionCoords:e.reconstructionCoords});break;case 1:t=s;break;case 2:case 3:n=e.readInputValue(),t=Object.assign(s,{seSize:n});break;case 4:let i,c,r;a=!0,console.log("case4"),$("#dicomImgModal").modal("hide"),cv.imshow("canvasOutput",e.focusedImage);const l=document.getElementById("canvasOutput").getContext("2d"),u=e.processingResponse.response[1];l.fillStyle="#fb0",l.font="bold 20px Arial",l.fontWeight,l.textBaseline="start",u.forEach(e=>{i=e.name,c=e.centroidX,r=e.centroidY,console.log(e,i),l.fillText(i,c,r)}),e.resetCarousel()}if(!a){let n="/kmeans/step2";"rgb(33, 165, 34)"==$("#fuzzy-button").css("background-color")&&(n="/fuzzy/step2"),c.sendPostRequest(n,t).done(function(t){console.log(t),e.processingResponse=t,i(),$("#dicomImgModal").is(":visible")||$("#dicomImgModal").modal();const n=cv.matFromArray(512,512,cv.CV_8U,[].concat.apply([],t.response[0]));e.focusedImage=n,cv.imshow("canvas1",n),e.choosenImageNumber=1}).fail(function(e){console.log(e)})}}else if("step1"===$(".carousel-input").attr("name")){console.log("KMEANS STEP2"),e.modifyInput("make hidden",null),e.choosenImageNumber=$(".carousel-input").val();const t=cv.matFromArray(512,512,cv.CV_8U,[].concat.apply([],e.clusteredImages[e.choosenImageNumber-1]));let n,o;e.focusedImage=t,$(".carousel-modal-title").text("Step 2: select further processing filter number"),$(".processing-filters").css({display:"inherit",color:"white"}),$(".carousel-input").attr("name","step2");e=this;n=this.activeSlideDOM.replace("#INDEX#",1).replace("#INDEX+1#",1),o=this.activeItemIndicator.replace("#INDEX+1#",1),console.log(n),$(".carousel-inner").html(n),$(".carousel-indicators").html(o),$(".carousel-item").css({width:"100%",height:"600px"}),cv.imshow("canvas1",t),this.activateCarousel(1),$("#dicomImgModal").modal()}},activateCarousel:function(e){$("#dicom-images-carousel").carousel();for(let t=1;t<=e;t++)$(`.item${t}`).click(function(){$("#dicom-images-carousel").carousel(t-1)});$(".carousel-control-prev").click(function(){$("#dicom-images-carousel").carousel("prev")}),$(".carousel-control-next").click(function(){$("#dicom-images-carousel").carousel("next")})},focusedImage:void 0,processingResponse:void 0,appendColours:function(){return $(".filters-list").find("li").filter(function(){return"rgb(208, 156, 0)"===$(this).css("background-color")})},modifyInput:function(e,t){switch(e){case"make visible":return $(".carousel-input").css({visibility:"visible"}),this;case"make hidden":return $(".carousel-input").css({visibility:"hidden"}),this;case"set placeholder":return $(".carousel-input").attr("placeholder",t),this;case"reset":return $(".carousel-input").val(null),this}},readInputValue:function(){return $(".carousel-input").val()},clusteredImages:null,reconstructionCoords:[],choosenImageNumber:null,activeSlideDOM:"\n    <div class='carousel-item active'\" + \">\n    <div class=\"slide-name\" style='color:white;font-size:20px'>Cluster number: #INDEX+1#</div> \n    <canvas id='canvas#INDEX#'></canvas>\n    </div>",notActiveSlideDOM:"\n    <div class='carousel-item'\" + \">\n            <div class=\"slide-name\" style='color:white;font-size:20px'>Cluster number: #INDEX+1#</div>\n            <canvas id='canvas#INDEX#'></canvas>\n    </div>",activeItemIndicator:"<li class='item#INDEX+1# active'\" + \"></li>",notActiveItemIndicator:"<li class='item#INDEX+1#'\" + \"></li>",emptyCarouselHTML:'<div id="dicom-images-carousel" class="carousel slide">\n    \x3c!-- Indicators --\x3e\n    <ul class="carousel-indicators">\n    </ul>\n    \x3c!-- The slideshow --\x3e\n    <div class="carousel-inner" style="text-align:center">\n    </div>\n    \x3c!-- Left and right controls --\x3e\n    <a class="carousel-control-prev" href="#dicom-images-carousel">\n      <span class="carousel-control-prev-icon"></span>\n    </a>\n    <a class="carousel-control-next" href="#dicom-images-carousel">\n      <span class="carousel-control-next-icon"></span>\n    </a>\n  </div>'}.activateClickEventListeners(),[]);$(document).ready(function(){a.activateClickEventListener(),$("#processing-button").click(()=>{if("rgb(33, 165, 34)"==$("#seed-button").css("background-color")){console.log("START SEED PROCESSING");const e=$("input[type=radio][name=seed]:checked").val(),t=a.getLoadedFileName(),n=$("input[type=radio][name='neighbours']:checked").val(),o="/seed"+`?fileName=${t}&ratio=${$("input[type=number][name='seed']").val()}&neighboursNumber=${n}&distance=${e}`;c.sendPostRequest(o,r).done(function(e){console.log("GOT RESPONSE"),i();const t=e.result[0],n=cv.matFromArray(512,512,cv.CV_8U,[].concat.apply([],t));let o,s,c;cv.imshow("canvasOutput",n);const a=document.getElementById("canvasOutput").getContext("2d");a.fillStyle="#fb0",a.font="bold 20px Arial",a.fontWeight,a.textBaseline="start",e.result[1].forEach(e=>{o=e.name,s=e.centroidX,c=e.centroidY,console.log(e,o),a.fillText(o,s,c)}),r=[],$("#seed-list").html('<div id="no-seeds">No seed points choosen</div>')}).fail(function(e){console.log(e)})}}),$(".cornerstone-canvas").click(function(e){$("#seed-list-item").length||$("#no-seeds").remove(),r.push({x:e.offsetX,y:e.offsetY}),o=$(`<li id="seed-list-item">X: ${e.offsetX} Y: ${e.offsetY}</li>`),$("#seed-list").append(o)})})}]);